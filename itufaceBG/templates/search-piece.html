<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>circle</title>
</head>
<body>


<script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<div id="app" align="center">
    <table>
        <tr>
            <td>
                <p>App_Cusomer_Id: {% verbatim %}{{rows.AppCustomerId}}{% endverbatim %}</p>
                <p>APP进件号: {% verbatim %}{{rows.AppRequestId}}{% endverbatim %}</p>
                <p>个贷进件号:{% verbatim %} {{rows.LendRequestId}}{% endverbatim %}</p>
                <p>APP状态:{% verbatim %} {{rows.AppStateType}}{% endverbatim %}</p>
                <p>个贷状态:{% verbatim %} {{rows.LendStatus}}{% endverbatim %}</p>
                <p>产品: {% verbatim %}{{rows.ProductName}}{% endverbatim %}</p>
                <p>用户名: {% verbatim %}{{rows.AppCustomerName}}{% endverbatim %}</p>
                <p>手机号: {% verbatim %}{{rows.AppMobile}}{% endverbatim %}</p>
                <p>APP里的身份证号: {% verbatim %}{{rows.AppIdNo}}{% endverbatim %}</p>
                <p>Log_in_ID: {% verbatim %}{{rows.AppLogin}}{% endverbatim %}</p>
                <p>销售工号: {% verbatim %}{{rows.SalesNo}}{% endverbatim %}</p>
                <p>个贷小状态状态: {% verbatim %}{{rows.LendMinStatus}}{% endverbatim %}</p>
                <p>个贷Customer_Id: {% verbatim %}{{rows.LendCustomerId}}{% endverbatim %}</p>
                <p>个贷身份证号: {% verbatim %}{{rows.LendCustomerIdNo}}{% endverbatim %}</p>
            </td>
        </tr>
    </table>

    <div v-if="showPrise">

        <button @click='choice'> {% verbatim %}{{button_choice}}{% endverbatim %}</button>
    </div>
    <div v-if="showMaterials">
        {% verbatim %}{{MaterialsMessage}}{% endverbatim %}
    </div>

</div>
<script>
    const address = 'http://172.16.113.79:8882'
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }

    new Vue({
        el: '#app',
        data() {

            return {
                rows: {},
                button_choice: '',
                showPrise: false,
                showMaterials:false,

            }
        },
        //
        mounted() {
            this.send()
        },
        methods: {
            choice() {
                this.showPrise = true
                console.log('adfa')

            },

            send() {
                app_id = getQueryVariable('id')

                axios.get(address + '/messages?', {
                    params: {AppRequestId: app_id},
                    headers: {
                        Auth: "YLS",
                        Token: 'C2wVRVeJ527xvlfsapxcIg==',
                    },
                }).then((response) => {

                    const data = response.data;
                    result = data.messages[0]
                    passe = ''
                    if (result['AppStateType'] == 'FIRST_SUPPLY_MATERIAL' ||result['AppStateType'] == 'SECOND_SUPPLY_MATERIAL' ) {
                        mobile = getQueryVariable('mobile')
                        showPrise = true
                        passe = '点击补充第一次补充材料'
                        if (result['AppStateType'] == 'SECOND_SUPPLY_MATERIAL' ){
                             passe = '点击补充第二次补充材料'
                        }
                        axios.post('{% url 'supplement-materials' %}', {
                                'mobile': mobile,
                                'status': result['AppStateType'],
                                'id': app_id
                            }
                        ).then((response)=>{
                            const inner_data=response.data;
                            showMaterials:true
                            MaterialsMessage=inner_data['message']

                        })

                    }
                    this.rows = result
                    this.button_choice = passe


                })
            }
        }


    });


</script>
<script>

</script>

</body>
</html>